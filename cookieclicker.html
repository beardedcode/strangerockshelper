<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rune Clicker Game</title>
    <style>
        @font-face {
            font-family: Rubik;
            src: url('Oxanium-VariableFont_wght.ttf') format('truetype');
        }

        body {
            text-align: center;
            font-family: 'Rubik', fallbackFont, sans-serif;
            background-color: rgb(15, 15, 15);
            overflow: hidden;
            /* Hide the overflow to keep the cookie within the window */
            margin: 0;
        }

        #gamewindow {
            height: 100vh;
            max-width: 100vw;
            min-width: 100vw;
            /*width: 100%;*/
            margin: 0;
            padding: 0;
            background-color: rgb(20, 20, 20);
            overflow: hidden;
        }

        #gameheader {
            background-color: rgb(111 163 197 / 0%);
            width: 100vw;
            min-width: 100%;
            /* Adjust the minimum width as needed */
            max-width: 100vw;
            margin: 0;
            padding: 0px;
            display: flex;
            overflow: hidden;
            justify-content: space-evenly;
            /* Align score and top score side by side */
            align-items: center;
            border-bottom: 2px solid rgb(184, 184, 184);
        }

        #cookie {
            width: 120px;
            height: auto;
            position: absolute;
            cursor: pointer;
            z-index: 1000;

        }

        /* Add the style for the trail element */
        .trail {
            position: absolute;
            width: 120px;
            height: 120px;
            background-color: rgba(242, 188, 188, 0.246);
            border-radius: 50%;
            transition: opacity 0.5s ease-in-out;
        }

        #score {
            font-size: 50px;
            color: aliceblue;
            overflow: hidden;
            position: absolute;
            left: 50%;
            /* Position the score at the center horizontally */
            transform: translateX(-50%);
            /* Center the score using transform */
            bottom: 10px;
            /* Adjust the bottom property as needed to position the score to the bottom */
        }

        h1 {
            color: rgb(255, 249, 249);
        }

        #topScore {
            font-size: 20px;
            color: #da2926;
            overflow: hidden;
            /* Red color for visibility */
        }

        #intervalText {
            font-size: 20px;
            color: #53c5e8;
            overflow: hidden;
            /* Red color for visibility */
        }
    </style>
</head>

<body>
    <div id="gameheader">
        <h1>Rune Clicker</h1>
        <p id="score"> <span id="scoreValue">0</span></p>
        <p id="topScore">Highscore: <span id="topScoreValue">0</span></p>
        <p id="intervalText">Speed: <span id="intervalValue">2000</span> ms</p>
    </div>
    <div id="gamewindow"><img id="cookie" src="images/cookie_level_1.png" alt="Cookie" onclick="clickCookie()"></div>
    <script>
        // Global variables
        let score = 0;
        let cookieClicked = false;
        let currentLevel = 1; // Start level
        let topScore = 0; // High score
        let intervalTime = 2000; // Initial interval time
        let cookieInterval; // Declare the cookieInterval variable globally

        const gamewindow = document.getElementById('gamewindow');
        // Initialize the starting position of the cookie
        // const initialX = window.innerWidth / 2;
        // const initialY = window.innerHeight / 2;
        const initialX = window.innerWidth / 2;
        const initialY = gamewindow.innerHeight / 2;
        //const initialY = window.innerHeight / 4;


        // Click cookie and update score
        function clickCookie() {
            if (!cookieClicked) {
                score++;
                cookieClicked = true;
                updateScore();
                checkLevel();
                updateCookieInterval();

                console.log("interval: " + intervalTime)
                // Start moving the cookie after the first click
                if (!cookieInterval) {
                    cookieInterval = setInterval(moveCookie, intervalTime);
                }
            }
        }

        function updateIntervalTime() {
            intervalTime = Math.max(1000, intervalTime -
                50); // Decrease interval time by 10 milliseconds, with a lower limit of 100 milliseconds
            document.getElementById('intervalValue').innerText = intervalTime;

        }

        // Function to update the cookie interval with the new interval time
        function updateCookieInterval() {
            clearInterval(cookieInterval);
            cookieInterval = setInterval(moveCookie, intervalTime);

        }

        // update score value text
        function updateScore() {
            document.getElementById('scoreValue').innerText = score;
        }

        // Move cookie randomly around window
        /* function moveCookie() {

             // Get cookie, game window, gameheader divs
             const cookie = document.getElementById('cookie');
             const gamewindow = document.getElementById('gamewindow');
             const gameheader = document.getElementById('gameheader');

             // Sets region for where cookie can move around
             const maxX = gamewindow.clientWidth - cookie.offsetWidth;
             const maxY = gamewindow.clientHeight - cookie.offsetHeight;

             // Update top score if the current score is higher
             if (score > topScore) {
                 topScore = score;
                 updateTopScore();
             }

             // Reset score to zero only if the cookie hasn't been clicked
             if (!cookieClicked) {
                 // Clear the interval and set it to null when the score resets to zero
                 clearInterval(cookieInterval);
                 cookieInterval = null;

                 // Reset intervalTime back to 2000
                 intervalTime = 2000;
                 document.getElementById('intervalValue').innerText = intervalTime;

                 score = 0; // set score to zero
                 currentLevel = 1; // Reset level back to 1
                 document.getElementById('cookie').src =
                     `images/cookie_level_${currentLevel}.png`; // Reset image to level 1
                 updateScore();

                 // Reset the cookie's position to the center
                 cookie.style.left = initialX + 'px';
                 cookie.style.top = initialY + 'px';
                 return; // Skip the rest of the function
             }

             // Reset the cookieClicked flag
             cookieClicked = false;

             // Sets the movement for the cookie based on x and y values
             const newX = Math.floor(Math.random() * maxX); // Left/right movements
             const newY = Math.floor(Math.random() * maxY); // Up/down movement

             // Ensure the cookie stays below the gameheader
             if (newY < gameheader.clientHeight) {
                 cookie.style.top = gameheader.clientHeight + 'px';
             } else {
                 cookie.style.top = newY + 'px';
             }

             cookie.style.left = newX + 'px';
         }*/


        // Move cookie randomly around window
        function moveCookie() {
            // Get cookie, game window, gameheader divs
            const cookie = document.getElementById('cookie');
            const gamewindow = document.getElementById('gamewindow');
            const gameheader = document.getElementById('gameheader');

            // Sets region for where cookie can move around
            const maxX = gamewindow.clientWidth - cookie.offsetWidth;
            const maxY = gamewindow.clientHeight - cookie.offsetHeight;

            // Update top score if the current score is higher
            if (score > topScore) {
                topScore = score;
                updateTopScore();
            }

            // Reset score to zero only if the cookie hasn't been clicked
            if (!cookieClicked) {
                // Reset intervalTime back to 2000
                intervalTime = 2000;
                document.getElementById('intervalValue').innerText = intervalTime;

                score = 0; // set score to zero
                currentLevel = 1; // Reset level back to 1
                document.getElementById('cookie').src =
                    `images/cookie_level_${currentLevel}.png`; // Reset image to level 1
                updateScore();

                // Reset the cookie's position to the center
                cookie.style.left = initialX + 'px';
                cookie.style.top = initialY + 'px';

                // Remove all existing trail elements
                const trailElements = document.getElementsByClassName('trail');
                while (trailElements.length > 0) {
                    trailElements[0].remove();
                }

                return; // Skip the rest of the function
            }

            // Reset the cookieClicked flag
            cookieClicked = false;

            // Sets the movement for the cookie based on x and y values
            const newX = Math.floor(Math.random() * maxX); // Left/right movements
            const newY = Math.floor(Math.random() * maxY); // Up/down movement

            // Ensure the cookie stays below the gameheader
            const newTop = Math.max(gameheader.clientHeight, newY);

            // Use requestAnimationFrame for smoother animation
            function animate() {
                // Get the current position of the cookie
                const currentX = parseFloat(cookie.style.left);
                const currentY = parseFloat(cookie.style.top);

                // Calculate the difference between the current position and the target position
                const deltaX = (newX - currentX) / 10; // Adjust the divisor for speed
                const deltaY = (newTop - currentY) / 10; // Adjust the divisor for speed

                // Check if the score is greater than zero before creating the trail
                if (score > 1) {
                    // Create a new ghost element for the trail
                    const ghostElement = document.createElement('div');
                    ghostElement.className = 'trail'; // You may need to define a CSS class for styling the trail
                    ghostElement.style.left = currentX + 'px';
                    ghostElement.style.top = currentY + 'px';
                    gamewindow.appendChild(ghostElement);

                    // Remove old trail elements to prevent excessive elements
                    const trailElements = document.getElementsByClassName('trail');
                    if (trailElements.length > 10) {
                        trailElements[0].remove();
                    }
                }
                // Check if the cookie hasn't reached the target position yet
                if (Math.abs(currentX - newX) > 1 || Math.abs(currentY - newTop) > 1) {
                    // Update the cookie's position by a fraction of the remaining distance
                    cookie.style.left = currentX + deltaX + 'px';
                    cookie.style.top = currentY + deltaY + 'px';

                    // Call the animate function again on the next frame
                    requestAnimationFrame(animate);
                } else {
                    // If the cookie is close enough to the target position, set it directly
                    cookie.style.left = newX + 'px';
                    cookie.style.top = newTop + 'px';
                }
            }

            animate();
        }

        // Call moveCookie() wherever appropriate in your code


        function checkLevel() {
            if (score % 5 === 0 && currentLevel < 6) {

                updateIntervalTime();
                // Change image every 4 scores until level 6
                currentLevel++;
                document.getElementById('cookie').src = `images/cookie/cookie_level_${currentLevel}.png`;

                // Decrease the interval time after each level
                // intervalTime -= 100; // You can adjust the decrement as needed

                // Clear the current interval
                //  clearInterval(cookieInterval);

                // Set a new interval with the updated interval time
                //  cookieInterval = setInterval(moveCookie, intervalTime);
                //  console.log(intervalTime)
                // Update the displayed interval time
                //  updateIntervalTime();
            }
        }

        function updateTopScore() {
            document.getElementById('topScoreValue').innerText = topScore;
        }

        // Move the cookie with the adjusted interval time
        //  let cookieInterval = setInterval(moveCookie, intervalTime);
    </script>

</body>

</html>